<html>
<video id="videoPlayer" controls></video>
<p id="version"></p>
<h3>download info:</h3>
<p id="peers"></p>
<p id="info"></p>
<script src="https://cdn.dashjs.org/v4.7.3/dash.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/dashjs"></script>
<script>
    var url = "https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd";
    var player = dashjs.MediaPlayer().create()
    document.querySelector('#version').innerText = `dash.js version: ${player.getVersion()} p2p version: ${P2PEngineDash.version}`;
    var p2pConfig = {
        logLevel: 'debug',
        //trackerZone: 'us',        
        //token: _pBGjXtHg
    }
    var engine = new P2PEngineDash(player, p2pConfig);
    player.initialize(document.querySelector("#videoPlayer"), url, true);
    
    window.performanceData = {
        startupDelays: [],
        bufferingEvents: [],
        p2pBandwidths: []
    };
    let bufferingCount = 0;
    const video = document.getElementById("videoPlayer");

    const startTime = Date.now();
    video.onplaying = () => {
        const delay = (Date.now() - startTime) / 1000;
        window.performanceData.startupDelays.push(delay);
        console.log(`Startup Delay: ${delay}s`);
    };

    video.onwaiting = () => {
        bufferingCount++;
        window.performanceData.bufferingEvents.push(bufferingCount);
        console.log("Buffering...");
    };

    engine.on('stats', function (stats) {
        var total = stats.totalHTTPDownloaded + stats.totalP2PDownloaded;
        document.querySelector('#info').innerText = `p2p ratio: ${Math.round(stats.totalP2PDownloaded / total * 100)}%   saved traffic: ${Math.round(stats.totalP2PDownloaded)}KB upload: ${Math.round(stats.totalP2PUploaded)}KB`;
        window.performanceData.p2pBandwidths.push(stats.totalP2PDownloaded / 1024); // Store in KB
    });

    engine.on('peers', function (peers) {
        document.querySelector('#peers').innerText = `peers: ${peers.length}`;
    })
</script>
</html>